{% extends "base.html" %}

{% block title %}Research Results{% endblock %}

{% block content %}
<h1>Research Results</h1>

<!-- ======================================================================================================================================= -->
<!-- Peaks Detection Section -->
<section id="results-carousel" class="btm-mrgin-section">
    <h2>Peaks Detection Analysis Results</h2>
    <div class="right_to_left">
        <p>הניתוח של זיהוי ה-peaks מספק תובנות משמעותיות לגבי עקומות סדרות הזמן עבור כל נבדק. </p>
        <p>תהליך זיהוי ה-peaks מאפשר לנו לזהות את נקודות השיא והעמקים בנתונים, דבר שיכול לספק מידע על תהליכים ותנודות
            בתוך הסדרה. </p>
        <p> להלן המפות החמות שמציינות את הpeaks שזוהו עבור כל נבדק. </p>
        <p> כל תמונה מציגה את הpeaks בגרף הזמן המתאים, עם הדגשה על המקומות שבהם נרשמו peaks.</p>
    </div>


    <div class="hive-container">
        <!-- Create carousel for each subject -->
        {% for subject, images in peaks_results.items() %}
        <div class="hive-cube">
            <h3>{{ subject }}</h3>
            <div id="carousel-{{ subject | replace(' ', '-') | replace('–', '-') }}" class="carousel slide">
                <div class="carousel-inner">
                    {% for image in images %}
                    <div class="carousel-item {% if loop.first %}active{% endif %}">
                        <div class="card">
                            <img src="{{ url_for('static', filename='peaks_figures/' ~ image.filename) }}"
                                class="card-img-top" alt="{{ subject }}"
                                onclick="openModal('{{ url_for('static', filename='peaks_figures/' ~ image.filename) }}')">
                            <div class="card-body">
                                <p class="card-text">This image represents the peaks detected in the time series data
                                    for {{ subject }}. Peaks indicate points of maximum in the graph, which allow us to
                                    analyze the behavior of the data.</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <a class="carousel-control-prev" href="#carousel-{{ subject | replace(' ', '-') | replace('–', '-') }}"
                    role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carousel-{{ subject | replace(' ', '-') | replace('–', '-') }}"
                    role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
<!-- Peaks Detection Section -->
<!-- ======================================================================================================================================= -->

<!-- ======================================================================================================================================= -->
<!-- Auto-Correlation Section -->
<section id="auto-correlation" class="section btm-mrgin-section">
    <h2>Auto-Correlation Analysis Results</h2>
    <div class="right_to_left">
        <p>הניתוח של AC מאפשר לנו להבין את הקשרים הפנימיים בתוך סדרות הזמן. </p>
        <p>באמצעות AC, נוכל לחקור את ההשפעה של ערכים עתידיים על ערכים נוכחיים ולהבין את הטרנדים והעונתיות בנתונים. </p>
        <p>התרשימים המוצגים להלן מציגים את תוצאות ה-AC עבור כל משתנה, עם דגש על התאמתה של הסדרה לעקומות צפויות וניתוח
            הדפוסים המתקבלים.</p>
    </div>

    <div class="hive-container">
        {% for subject, results in auto_corr_results.items() %}
        <div class="hive-cube">
            <h3>{{ subject }}</h3>
            <div id="carousel-auto-correlation-{{ subject | replace(' ', '-') | replace('–', '-') }}"
                class="carousel slide">
                <div class="carousel-inner">
                    {% for result in results %}
                    <div class="carousel-item {% if loop.first %}active{% endif %}">
                        <div class="card">
                            <img src="{{ url_for('static', filename='auto_corr_figures/' ~ result['auto_corr_plot']) }}"
                                class="card-img-top" alt="Auto-correlation for {{ subject }}"
                                onclick="openModal('{{ url_for('static', filename='auto_corr_figures/' ~ result['auto_corr_plot']) }}')">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <a class="carousel-control-prev"
                    href="#carousel-auto-correlation-{{ subject | replace(' ', '-') | replace('–', '-') }}"
                    role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next"
                    href="#carousel-auto-correlation-{{ subject | replace(' ', '-') | replace('–', '-') }}"
                    role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
<!-- Auto-Correlation Section -->
<!-- ======================================================================================================================================= -->

<!-- ======================================================================================================================================= -->
<!-- Cross-Correlation Section -->
<section id="cross-correlation-carousel" class="btm-mrgin-section">
    <h2>Cross-Correlation Analysis Results</h2>
    <div class="right_to_left">
        <p>Cross-Correlation הוא שיטה סטטיסטית המשמשת למדידת הדמיון בין שתי סדרות זמן כפונקציה של ההסטה של אחת ביחס
            לשנייה.
            בהקשר של הניתוח שלנו, זה עוזר לנו להבין כיצד מגמות שפה שונות הקשורות לנושאים ספציפיים מתואמות לאורך זמן.</p>

        <h4>היבטים מרכזיים של ניתוח ה-Cross-Correlation שלנו:</h4>
        <ul>
            <li><strong>מקדם מתאם:</strong> הערכים נעים בין -1 ל-1, כאשר:
                <ul>
                    <li>1 מציין מתאם חיובי מושלם</li>
                    <li>-1 מציין מתאם שלילי מושלם</li>
                    <li>0 מציין שאין מתאם</li>
                </ul>
            </li>
            <li><strong>המתאם הגבוה ביותר:</strong> אנו מדווחים על המתאם המקסימלי וה-Lag המתאימה לו, המציינים את
                הקשר החזק ביותר שנמצא בין זוגות שפות עבור כל נושא.</li>
        </ul>

        <p>פירוש התוצאות:</p>
        <ul>
            <li>מתאם חיובי גבוה מציע שמגמות בשפות שונות נעות באופן דומה.</li>
            <li>מתאם שלילי גבוה מציין תנועות הפוכות במגמות.</li>
            <li>ערך ה-Lag מראה כמה יחידות זמן סדרה אחת מובילה או מפגרת אחרי השנייה.</li>
        </ul>

        <p>ניתוח זה עוזר לזהות כיצד מגמות בקהילות שפה שונות קשורות זו לזו, וייתכן שיחשוף יחסי הובלה-פיגור בהפצת מידע או
            באימוץ מגמות מעבר לגבולות לשוניים.</p>
    </div>

    <div class="hive-container">
        {% if cross_corr_results.empty %}
        <p class="red-bold">No cross-correlation results available.</p>
        {% else %}
        <!-- Display cross-correlation results in a table -->
        {% for subject, data in cross_corr_results.groupby('subject') %}
        <div class="hive-cube">
            <h3>{{ subject }}</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Page 1</th>
                        <th>Page 2</th>
                        <th>Lag</th>
                        <th>Correlation</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in data.iterrows() %}
                    <tr>
                        <td>{{ row['Page 1'] }}</td>
                        <td>{{ row['Page 2'] }}</td>
                        <td>{{ row['lag'] }}</td>
                        <td>{{ row['correlation'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}
        {% endif %}
    </div>

</section>
<!-- Cross-Correlation Section -->
<!-- ======================================================================================================================================= -->


<!-- ======================================================================================================================================= -->
<!-- ARIMA Model Section -->
<section id="arima-carousel" class="btm-mrgin-section">
    <h2>ARIMA Model Analysis Results</h2>
    <div class="right_to_left">
        <p>The ARIMA model analysis provides insights into time series forecasting.</p>
        <p>Each subject is represented by a table displaying the forecasted values and confidence intervals.</p>
        <p>Model details:</p>
        <ul>
            <li>Model order: (p,d,q) values, where:
                <ul>
                    <li>p: autoregressive order</li>
                    <li>d: degree of differencing</li>
                    <li>q: moving average order</li>
                </ul>
            </li>
            <li>Coefficient estimates: values for the AR and MA terms, along with their standard errors.</li>
            <li>Statistical significance: P or t-statistics for each coefficient, indicating their significance.</li>
            <li>Information criteria: AIC and BIC for model comparison.</li>
            <li>Log-likelihood: a measure of model fit.</li>
            <li>Residual statistics: including the regression standard error.</li>
            <li>Residual diagnostics: tests for normality and autocorrelation of the residuals.</li>
            <li>Forecast accuracy metrics: such as Mean Absolute Error (MAE) or Root Mean Squared Error (RMSE) if a
                forecast was made.</li>
            <li>Model summary: overall fit statistics and explanatory power of the model.</li>
        </ul>
    </div>


    <div class="hive-container">
        {% for subject, arima_data_list in arima_results.items() %}
        <div class="hive-cube">
            <h3>{{ subject }}</h3>
            {% for arima_data in arima_data_list %}
            <div class="container">
                <img src="{{ 'static/arima_figures/' ~ arima_data['filename'] }}" alt="{{ arima_data['filename'] }}"
                    class="card-img-top" onclick="openModal('{{ 'static/arima_figures/' ~ arima_data['filename'] }}')">
            </div>
            <div class="container btm-mrgin-section">
                <div class="scrollable-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Forecast</th>
                                <th>Actual</th>
                                <th>MAE</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for forecast in arima_data['forecast'] %}
                            <tr>
                                <td>{{ forecast['Date'] }}</td>
                                <td>{{ forecast['Forecast'] }}</td>
                                <td>{{ forecast['Actual'] }}</td>
                                <td>{{ forecast['MAE'] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}

    </div>
</section>
<!-- ARIMA Model Section -->
{% endblock %}